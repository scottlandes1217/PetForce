<div class="tabbed-navigation" data-controller="tabbed-navigation">
  <div class="nav-tabs-container">
    <div class="nav-tabs-scroll">
      <div class="nav-tabs" data-tabbed-navigation-target="tabsContainer">
        <% if user_signed_in? && @pinned_tabs.present? %>
          <% Rails.logger.info 'Pinned tabs array: ' + @pinned_tabs.map { |t| "ID=#{t.id}, Pos=#{t.position}" }.join(', ') %>
          <% @pinned_tabs.each do |tab| %>
            <% is_active = current_page?(tab.url) %>
            <% Rails.logger.info "Rendering tab: ID=#{tab.id}, Title=#{tab.title}, Position=#{tab.position.inspect}" %>
            <div class="nav-tab" 
                 data-tab-id="<%= tab.id %>" 
                 data-tab-type="<%= tab.tab_type %>" 
                 data-tab-url="<%= tab.url %>" 
                 data-record-id="<%= tab.tabable_id %>"
                 data-position="<%= tab.position %>">
              <div class="nav-tab-content <%= 'active' if is_active %>" data-action="click->tabbed-navigation#switchToTab">
                <i class="<%= tab.tab_type == 'pet' ? 'fas fa-paw' : 'fas fa-tasks' %> me-2"></i>
                <span class="nav-tab-title"><%= tab.title %></span>
                <div class="nav-tab-actions">
                  <button class="nav-tab-close" data-action="click->tabbed-navigation#unpinAndClose" title="Unpin and close tab">
                    <i class="fas fa-times"></i>
                  </button>
                </div>
              </div>
            </div>
          <% end %>
        <% end %>
        <!-- Unpinned tabs will be dynamically added here by JavaScript -->
      </div>
    </div>
  </div>
  
  <!-- Tab Actions Dropdown (3-dot menu) -->
  <div class="nav-tabs-actions dropdown align-bottom ms-3">
    <button class="btn btn-sm btn-outline-secondary dropdown-toggle px-2 py-1" type="button" id="tabMenuDropdown" data-bs-toggle="dropdown" aria-expanded="false" title="Tab actions">
      <i class="fas fa-ellipsis-h fa-lg"></i>
    </button>
    <ul class="dropdown-menu dropdown-menu-end mt-1" aria-labelledby="tabMenuDropdown" style="min-width: 180px; left: -8px !important;">
      <!-- Overflowed tabs will be dynamically inserted here by JS -->
      <div id="overflowed-tabs-list" class="overflowed-tabs-list"></div>
      <li><hr class="tab-menu-divider"></li>
      <li><a class="dropdown-item" href="#" data-action="tabbed-navigation#unpinAllTabs">Unpin all tabs</a></li>
    </ul>
  </div>
</div> 